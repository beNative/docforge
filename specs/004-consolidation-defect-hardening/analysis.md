# Cross-Artifact Analysis: Consolidation & Defect Hardening

## Findings

| Location | Severity | Rationale | Suggested Fix | Backlog Alignment |
| --- | --- | --- | --- | --- |
| `plan.md`:15 vs `tsconfig.json`:9-15 | Low | Section 3 of the plan still claims the TypeScript config lacks full strictness, yet the repo now enables `strict`, `noImplicitOverride`, and `exactOptionalPropertyTypes`, which can confuse governance reviews. | Refresh the baseline narrative to acknowledge the stricter compiler posture while flagging the remaining gaps (`noUncheckedIndexedAccess`, `noFallthroughCasesInSwitch`). | TypeScript Consolidation workstream (tasks §1). |
| `tsconfig.json`:9-15 vs FR-001 (`spec.md`:68-76) | Medium | FR-001 asks for “strict plus complementary flags such as `noUncheckedIndexedAccess`,” but the config omits both `noUncheckedIndexedAccess` and `noFallthroughCasesInSwitch`, leaving unchecked property access and switch fallthrough risks. | Extend compiler options with the missing flags and rerun `npm run typecheck` to catalogue follow-up fixes. | TypeScript Consolidation workstream (tasks §1). |
| `tsconfig.typecheck.json`:4-10 vs Scenario 1 (`spec.md`:27-32) | Low | The dedicated typecheck config now excludes `services/preview/__tests__` and `vitest.config.ts`, so preview renderer helpers fall outside the strict `npm run typecheck` sweep promised in Scenario 1. | Reintroduce those folders (or move problematic fixtures behind a separate config) once their diagnostics are addressed. | TypeScript Consolidation workstream (tasks §1). |
| `package.json`:6-34 vs FR-002 (`spec.md`:70-78) | Medium | Acceptance criteria require `eslint .` with zero warnings, but there are still no lint/format scripts or ESLint configuration, leaving CI without enforcement hooks. | Land ESLint/Prettier configs, wire `npm run lint`, `npm run lint:fix`, and `npm run format:check`, and add them to CI. | Lint & Format Zero-Warning Policy workstream (tasks §2). |
| `electron/preload.ts`:32-140 vs FR-003 (`spec.md`:70-76) | High | The preload bridge exposes dozens of IPC entry points that accept `any` payloads and forward them unchecked, allowing arbitrary SQL, filesystem paths, or Python commands into the main process. | Introduce shared Zod contracts, infer types for the preload surface, and reject payloads that fail validation before they reach `ipcMain`. | IPC Documentation & Validation workstream (tasks §3). |
| `electron/main.ts`:374-383 & 652-960 vs FR-003/FR-004 (`spec.md`:70-78) | High | The main process mirrors the preload behavior: `ipcMain.handle` routes raw renderer data straight into database and Python helpers, and the only global handler is `log.catchErrors`, leaving no `process.on('unhandledRejection')` safety net. | Build typed IPC dispatchers that validate requests, add central rejection/exception hooks via the planned logger, and align handlers with the shared schemas. | IPC Documentation & Validation + Error Handling workstreams (tasks §§3-4). |
| `electron/database.ts`:488-559 vs FR-001/FR-004 (`spec.md`:70-78) | High | Database helpers still accept `any[]` parameters, return `any`, and execute migrations directly with renderer-provided values, undermining strict typing and sanitization goals. | Model explicit DTOs, require structured/parameterized inputs, and wrap migrations in validated transactions. | TypeScript Consolidation + Packaging Reliability workstreams (tasks §§1 & 5). |

## Notes
- Validate that follow-on task breakdowns reference these specific gaps so workstreams can be scoped accurately.
- Re-run planning once documentation corrections (e.g., strictness baseline) are merged per governance policy.
